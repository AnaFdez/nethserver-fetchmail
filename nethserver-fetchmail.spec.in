Name:		nethserver-fetchmail
Version:        @@VERSION@@
Release:        @@RELEASE@@
Summary:	NethServer fetchmail
Group:		Networking/Daemons
License:	GPLv2
URL:		http://www.nethesis.it
Source0:	%{name}-%{version}.tar.gz
BuildArch: 	noarch

BuildRequires:	nethserver-devtools
Requires:	nethserver-mail-server
Requires:	fetchmail

%description
Fetchmail add-on for NethServer


%prep
%setup

%build
perl createlinks

%install
rm -rf $RPM_BUILD_ROOT
(cd root ; find . -depth -print | cpio -dump $RPM_BUILD_ROOT)
/sbin/e-smith/genfilelist --file '/usr/local/bin/fetchmail_wrapper' 'attr(0755,root,root)'  $RPM_BUILD_ROOT > %{name}-%{version}-filelist
echo "%doc COPYING" >> %{name}-%{version}-%{release}-filelist

%clean 
rm -rf $RPM_BUILD_ROOT

%pre
# Add the "fetchmail" user
getent group fetchmail >/dev/null || groupadd -r fetchmail
getent passwd fetchmail >/dev/null || \
useradd -r -g fetchmail -s /sbin/nologin \
    -d /home/fetchmail -c "Fetchmail user" -m fetchmail
exit 0


%preun
%post
if [ ! -f /var/log/fetchmail.log ]; then
	touch /var/log/fetchmail.log
fi
chown fetchmail:admin /var/log/fetchmail.log &>/dev/null || :

%postun

%files -f %{name}-%{version}-filelist
%defattr(-,root,root)

%changelog
* Wed Oct 16 2013 Giacomo Sanchietti <giacomo.sanchietti@nethesis.it> - 1.0.1-1.ns6
- Allow email address as username for login  #2183
- Db defaults: remove Runlevels prop #2067

* Tue Apr 30 2013 Giacomo Sanchietti <giacomo.sanchietti@nethesis.it> - 1.0.0-1.ns6
- First release #1745 
